\section{Lebesgue Measurable Functions}

\begin{exercise}{4.3}
  If $F$ is measurable as defined, then the sets
  \begin{align*}
    &F^{-1}((a,+\infty)\times\mathbb{R})=\{f>a\}
  \end{align*}
  and
  \begin{align*}
    &F^{-1}(\mathbb{R}\times(b,+\infty))=\{g>b\}
  \end{align*}
  are measurable for any $a,b\in\mathbb{R}.$
  Therefore $f$ and $g$ are measurable.
  Conversely, let $G$ be any open set in $\mathbb{R}^2$,
  then there exist partly open intervals $I_i$ and $J_i$ such that
  \[G=\bigcup_{i=1}^\infty I_i\times J_i.\]
  Then \[F^{-1}(G)=\bigcup_{i=1}^\infty F^{-1}(I_i\times J_i)=\bigcup_{i=1}^\infty f^{-1}(I_i)\cap g^{-1}(J_i).\]
  Since $f$ and $g$ are measurable,
  we have $f^{-1}(I_i)$ and $g^{-1}(J_i)$ are measurable sets.
  Thus $F^{-1}(G)$ is a measurable set and $F$ is measurable.
\end{exercise}

\begin{exercise}{4.5}
  We consider the equivalence relation on $[0,1]$
  defined by $x\sim y\Leftrightarrow x-y\in\mathbb{Q}$.
  Let $E$ be a set consisting exactly one element from each equivalence class
  and in particular let $0\in E$.
  Thus no nonzero rational numbers belong to $E$ and we also know that $E$ is nonmeasurable.
  Let $F$ be the Cantor-Lebesgue function and $Z=F^{-1}(E)$.
  By definition of $F$, elements outside the Cantor set are mapped to nonzero rational values by $F$,
  so we must have $Z\subset C$, the Cantor set.
  Thus $|Z|\leq |C|=0.$
  Define $\phi=\chi_Z$, the characteristic function of $Z$.
  Since $Z$ is a measurable set,
  $\phi$ is a measurable function.
  Now we define \[f(y)=\inf\{x\in[0:1]:x\in F^{-1}(y)\}. \]
  Then since $F$ is continuous and monotone,
  we have $F(f(y))=y$ and $\{f>a\}$ is an interval.
  We deduce that $f$ is also measurable.
  Now for any $y\in E$, we have \[y\in E\Rightarrow f(y)\in F^{-1}(y)\subset F^{-1}(E)=Z.\]
  On the other hand if $f(y)\in Z$, we have $y=F(f(y))\in F(Z)=F(F^{-1}(E))=E$.
  The last equality comes from the fact that $F$ is surjective from $[0,1]$ to $[0,1]$.
  Therefore we have \[f(y)\in Z\Leftrightarrow y\in E.\]
  Now \[(\phi\circ f)^{-1}(\{1\})=\{y:f(y)\in Z\}=E.\]
  Therefore $\phi\circ f$ is not measurable.

  Now if $g(x)=x+F(x)$, we notice that $[0,1]\setminus C$ is a disjoint union of open intervals $\{I_i\}$
  and $F$ is constant on each of the intervals.
  Since $g$ is strictly monotone, it follows that $g(I_i)$ are still disjoint intervals with the same measures as $I_i$.
  Thus \[|g([0,1]\setminus C)|=\sum_i|g(I_i)|=\sum_i|I_i|=|[0,1]\setminus C|=1.\]
  Therefore since $g$ is strictly monotone,
  we have \[|g(C)|=|[0,2]-g([0,1]\setminus C)|=2-1=1.\]
  By Corollary 3.39 there exists a nonmeasurable set $E$ in $g(C)$.
  Let $Z=g^{-1}(E)$.
  Then $Z$ is a subset of $C$ and is a measurable set of measure zero.
  Define $\phi=\chi_Z$ and $f=g^{-1}$, then $\phi$ is measurable and $f$ is continuous.
  However, we have
  \begin{align*}
  (\phi\circ f)^{-1}(\{1\})=\{y\in[0,2]:f(y)\in Z\}=\{y:y\in g(Z)\}=g(Z)=E.
  \end{align*}
  Therefore $\phi\circ f$ is not measurable.
\end{exercise}

\noindent\textbf{Exercise 4.12. }

\begin{proof} (Constructive proof) Suppose $f$ is continuous at almost every point of an interval $[a,b]$ and so $f$ is finite a.e.\ on $[a,b]$.
Let $\{\Gamma_k\}$ be a sequence of partitions of $[a,b]$ with norms $|\Gamma_k|$ tending to zero.
For each $k$, define a simple measurable function $l_k$ as follows:
if $x_1^{(k)}<x_2^{(k)}<\cdots$ are the partitioning points of $\Gamma_k$,
let $l_k(x)$ be defined in each semiopen interval $[x_i^{(k)},x_{i+1}^{(k)})$ as
$\max\{\inf_{[x_i^{(k)},x_{i+1}^{(k)}]}f,-k\}$ which is finite.
Suppose $f$ is continuous at $x\in[a,b)$, then for a given $\epsilon>0$,
there is a neighborhood $[a_x,b_x]$ of $x$ such that $|f(x)-f(y)|\leq \epsilon$
whenever $y\in [a_x,b_x]$.
Then we can choose a $K_1$ sufficiently large such that $f(y)> -K_1$ for each $y\in [a_x,b_x]$.
Since $|\Gamma_k|\to 0$, there is a $K_2>K_1$ such that for any $k\geq K_2$,
$x\in [x_{i_k}^{(k)},x_{{i_k}+1}^{(k)})\subset [a_x,b_x]$ for some $i_k$.
Then $|f(x)-l_k(x)|=|f(x)-\inf_{[x_{i_k}^{(k)},x_{i_{k}+1}^{(k)}]}f|\leq\epsilon$.
This proves that $l_k$ converges a.e.\ to $f$ and
thus that $f$ is measurable on $[a,b]$ by Theorem 4.12.
\end{proof}

Now we generalize this to functions defined in $\mathbf{R^n}$ by using a non-constructive way.

\begin{proof}(Non-constructive proof)
  Suppose $f$ is continuous a.e.\ on a measurable set $E\subset \mathbf{R^n}$,
  then we can write $E$ as a disjoint union $E=E_1\cup E_2$,
  where $f$ is continuous on $E_1$ and $|E_2|=0$.
  Note that the fact $f$ is continuous a.e.\ on $E$ implies
  $\{\bfx\in E:f(x)=+\infty\}$ is a set of measure zero and hence is measurable.
  To prove $f$ is measurable on $E$, by Corollary 4.2,
  we only need to show $\{\bfx\in E: a\leq f(\bfx)<+\infty\}$ is measurable for every finite $a$.
  Note that \[\{\bfx\in E: a\leq f(\bfx)<+\infty\}=\{\bfx\in E_1: a\leq f(\bfx)<+\infty\}\cup\{\bfx\in E_2: a\leq f(\bfx)<+\infty\}\eqqcolon A\cup B,\]
  where $B$ is a set of measure zero and hence is measurable.
  Let $\bfx_0$ be a limit point of $A$ that lies in $E_1$.
  Then there exist $\bfx_k\in E_1$ such that $\bfx_k\to \bfx_0$ and $a\leq f(\bfx_k)<+\infty$.
  Since $f$ is continuous at $\bfx_0\in E_1$,
  we have $a\leq \lim_{k\to\infty}f(\bfx_k)=f(\bfx_0)<+\infty$
  and then $\bfx_0\in A$.
  By Theorem 1.8, it follows that $A$ is relatively closed with respect to $E_1$ and then $A=E_1\cap F$ for some closed $F$.
  Hence $A$ is measurable and so is $\{\bfx\in E: a\leq f(\bfx)<+\infty\}$.
\end{proof}

\begin{exercise}{4.15}
  Define
  \[
    E_n = \left\{ x \in E : \lvert f_k(x) \rvert \le n
    \text{ for all $k$} \right\}
    = \bigcap_{k=1}^{\infty}
    \left\{ x \in E : \lvert f_k(x) \rvert \le n \right\}.
  \]
  Note that $E_n$ is measurable
  since $f_k$ is measurable
  and so is $\left\{ x \in E : \lvert f_k(x) \rvert \le n \right\}$.
  For each $x \in E$,
  we have $x \in E_n$ for all $n \ge M_x$,
  so $E = \bigcup E_n$.
  Since $E_n$ is increasing,
  we have $\lim \mea{E_n} = \mea{E} < +\infty$.
  Therefore, we can select $M \in \bbZ^+$ so large that
  $\mea{E - E_M} = \mea{E} - \mea{E_M} < \epsilon/2$,
  and in turn select a closed set $F \subset E_M$ such that
  $\mea{E_M - F} < \epsilon/2$.
  It follows that $\mea{E - F} = \mea{E - E_M} + \mea{E_M - F} < \epsilon$,
  and for each $x \in F$ we have
  $\lvert f_k(x) \rvert \le M$ for all $k$.
\end{exercise}

\begin{exercise}{4.16}
  Recall that $f_k \xrightarrow{m} f$ if for every $\epsilon > 0$,
  \begin{equation}
    \lim_{k \rightarrow \infty} \mea{\left\{ \lvert f - f_k \rvert > \epsilon \right\}} = 0.
    \label{eq:defOfCvgInMeasure}
  \end{equation}
  Assume $f_k \xrightarrow{m} f$.
  Given $\epsilon > 0$,
  there exists, according to~\eqref{eq:defOfCvgInMeasure}, a $K$ such that
  $\mea{\left\{ \lvert f - f_k \rvert > \epsilon \right\}} < \epsilon$
  for all $k > K$.

  Conversely, assume for each $\epsilon > 0$ there exists a $K$ such that
  $\mea{\left\{ \lvert f - f_k \rvert > \epsilon \right\}} < \epsilon$
  for all $k > K$.
  Then for each $\epsilon > 0$ and each $\epsilon_1 > 0$,
  we can take $\delta = \min \left\{ \epsilon, \epsilon_1 \right\} > 0$,
  and by assumption there exists a $K$ such that
  $\mea{\left\{ \lvert f - f_k \rvert > \delta \right\}} < \delta$
  for all $k > K$.
  Then
  \[
    \mea{\left\{ \lvert f - f_k \rvert > \epsilon \right\}}
    \le \mea{\left\{ \lvert f - f_k \rvert > \delta \right\}}
    < \delta \le \epsilon_1
  \]
  for all $k > K$, which shows exactly $f_k \xrightarrow{m} f$.

  An analogous Cauchy criterion is that
  $\{f_k\}$ is Cauchy in measure if and only if
  for each $\epsilon > 0$,
  there exists a $K$ such that
  \[
    \mea{\left\{ \lvert f_j - f_k \rvert > \epsilon \right\}} < \epsilon
  \]
  for all $j, k > K$.
\end{exercise}

\begin{lemma}
  If $g$ is finite a.e.\ on $E$ and $|E|<+\infty$,
  then for each $\epsilon > 0$
  there exist a subset $F$ of $E$ and a sufficiently large $M$ such that
  $\mea{E - F} < \epsilon$ and $\lvert g \rvert \le M$ on $F$.
\end{lemma}
\begin{proof}
  This is a special case of Exercise 4.15.
\end{proof}

\begin{exercise}{4.17}
  Suppose $f_k \xrightarrow{m} f$ and $g_k \xrightarrow{m} g$ on $E$.
  First we show $f_k + g_k \xrightarrow{m} f+g$.
  Given $\epsilon > 0$,
  we can select $K$ so large that
  \[
    \mea{\left\{ \lvert f - f_k \rvert > \frac{\epsilon}{2} \right\}} < \frac{\epsilon}{2},
    \quad
    \mea{\left\{ \lvert g - g_k \rvert > \frac{\epsilon}{2} \right\}} < \frac{\epsilon}{2},
  \]
  for all $k \ge K$.
  Since $\lvert (f_k + g_k) - (f+g) \rvert \le
  \lvert f_k - f \rvert + \lvert g_k - g \rvert$,
  we have
  \[
    \mea{\left\{ \lvert (f_k + g_k) - (f+g) \rvert > \epsilon \right\}} \le
    \mea{\left\{ \lvert f_k - f \rvert > \frac{\epsilon}{2} \right\}}
    + \mea{\left\{ \lvert g_k - g \rvert > \frac{\epsilon}{2} \right\}}
    < \frac{\epsilon}{2} + \frac{\epsilon}{2} = \epsilon
  \]
  for all $k \ge K$, which shows that $f_k + g_k \xrightarrow{m} f + g$.

  Suppose further that $\mea{E} < +\infty$.
  For each $\epsilon > 0$,
  we first invoke the preceding Lemma to select $M$ such that
  \[
    \mea{\left\{ \lvert f \rvert > M \right\}} < \epsilon/6, \quad
    \mea{\left\{ \lvert g \rvert > M \right\}} < \epsilon/6.
  \]
  Let $\delta = \min\left\{ \epsilon/3, \epsilon/3M, 1 \right\}$.
  By convergence in measure we can select $K$ so large that
  \[
    \mea{\left\{ \lvert f_k - f \rvert > \delta \right\}} < \epsilon/6, \quad
    \mea{\left\{ \lvert g_k - g \rvert > \delta \right\}} < \epsilon/6,
  \]
  for all $k \ge K$.
  Then we have
  \[
    \mea{\left\{ \lvert f_k - f)(g_k - g) \rvert > \epsilon/3 \right\} }
    \le \mea{\left\{ \lvert f_k - f \rvert > \epsilon/3 \right\}}
    + \mea{\left\{ \lvert g_k - g \rvert > 1 \right\}}
    < \epsilon/6 + \epsilon/6 = \epsilon/3.
  \]
  Moreover, we have
  \[
    \mea{\left\{ \lvert f (g_k - g) \rvert > \epsilon/3 \right\}}
    \le \mea{\left\{ \lvert f \rvert > M \right\}}
    + \mea{\left\{ \lvert g_k - g \rvert > \frac{\epsilon}{3M} \right\}}
    < \epsilon/6 + \epsilon/6 = \epsilon/3,
  \]
  and the same argument suggests
  \[
    \mea{\left\{ \lvert g (f_k - f) \rvert > \epsilon/3 \right\}} < \epsilon/3.
  \]
  Writing $f_k g_k - fg = (f_k - f)(g_k - g) + f(g_k - g) + g(f_k - f)$,
  we obtain
  \[
    \begin{aligned}
      \mea{\left\{ \lvert f_k g_k - fg \rvert \right\} > \epsilon}
      \le &\mea{\left\{ \lvert f_k - f)(g_k - g) \rvert > \epsilon/3 \right\} } \\
      + &\mea{\left\{ \lvert f (g_k - g) \rvert > \epsilon/3 \right\}} \\
      + &\mea{\left\{ \lvert g (f_k - f) \rvert > \epsilon/3 \right\}} \\
      < &\epsilon
    \end{aligned}
  \]
  for all $k \ge K$, which shows that $f_k g_k \xrightarrow{m} fg$.

  Finally suppose $g_k \rightarrow g$ on $E$ and $g \neq 0$ a.e.
  Since $\mea{E} < +\infty$, $1/g_k \rightarrow 1/g$ and $1/g$ is finite a.e.,
  Theorem 4.21 suggests that $1/g_k \xrightarrow{m} 1/g$.
  It follows immediately from the last case that $f_k/g_k \xrightarrow{m} f/g$.
\end{exercise}

\begin{exercise}{4.18}
  For the first part, fix $a \in (-\infty, +\infty)$.
  For each $x \in E$,
  it follows from $f_k \nearrow f$ that
  $f(x) > a$ if and only if $f_k(x) > a$ for some $k$.
  That is, $\left\{ f > a \right\} = \bigcup_{k=1}^{\infty} \left\{ f_k > a \right\}$.
  Since $\left\{ f_k > a \right\}$ is increasing,
  we see that $\omega_{f_k}(a) = \mea{\left\{ f_k > a \right\}} \nearrow
  \mea{\left\{ f > a \right\}} = \omega_f(a)$ as $k \rightarrow \infty$.

  Now suppose $f_k \xrightarrow{m} f$.
  For each $\epsilon > 0$, we have
  \[
    \omega_f(a + \epsilon) = \mea{\left\{ f > a + \epsilon \right\}} \le
    \mea{\left\{ f_k > a \right\}} + \mea{\left\{ \lvert f_k - f \rvert > \epsilon \right\}}
    = \omega_{f_k}(a) + \mea{\left\{ \lvert f_k - f \rvert > \epsilon \right\}}.
  \]
  But $f_k \xrightarrow{m} f$ implies that
  $\mea{\left\{ \lvert f_k - f \rvert > \epsilon \right\}} \rightarrow 0$
  as $k \rightarrow \infty$;
  taking limit inferior of the last inequality we obtain
  \[
    \omega_f(a + \epsilon) \le \liminf_{k \rightarrow \infty} \omega_{f_k}(a).
  \]
  Since $\epsilon > 0$ is arbitrary,
  by letting $\epsilon \rightarrow 0^+$ we see that
  $\omega_f(a) \le \liminf \omega_{f_k}(a)$
  provided $\omega_f$ is continuous at $a$.
  A similar argument shows that $\limsup \omega_{f_k}(a) \le \omega_f(a)$.
  We conclude that $\lim \omega_{f_k}(a) = \omega_f(a)$
  provided $\omega_f$ is continuous at $a$.
\end{exercise}
